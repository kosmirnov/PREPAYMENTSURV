theme_bw()
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(VOL.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#00A3E0","#BBBCBC"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw())
fit.VOL
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(LTV.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#00A3E0","#BBBCBC"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw())
FNMA$VOL.CAT <- cut(FNMA$ORIG_AMT, breaks=c(-Inf,150000,300000, Inf), labels=c("1","2","3"))
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw())
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(VOL.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw())
ggplot(SMM.null, aes(x=time, y=CPR)) +
geom_line(aes(),colour="#86BC25")+
theme_bw()
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw())
?ggsurvplot
ggsurvplot(fit.null, risk.table = TRUE,  palette=c("#86BC25"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(), legend=c("None"))
ggsurvplot(fit.null, risk.table = TRUE,  palette=c("#86BC25"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(), legend=c("none"))
?ggsurvplot
ggsurvplot(fit.null, risk.table = TRUE,  palette=c("#86BC25"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(), legend=c("none"),risk.table.title=c("none"))
ggsurvplot(fit.null, cumevents = TRUE,  palette=c("#86BC25"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(), legend=c("none"))
ggsurvplot(fit.null, cumevents = TRUE,  palette=c("#86BC25"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(), legend=c("none"))
ggsurvplot(fit.null, risk.table = TRUE,  palette=c("#86BC25"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(), legend=c("none"))
?ggsurvplot
FNMA$VOL.CAT <- cut(FNMA$ORIG_AMT, breaks=c(-Inf,150000,300000, Inf), labels=c("<150k$","150k$-300$",">300k$"))
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(VOL.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw())
FNMA$VOL.CAT <- cut(FNMA$ORIG_AMT, breaks=c(-Inf,150000,300000, Inf), labels=c("<150","150-300",">300"))
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(VOL.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw())
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c("Stratified by LTV"),"")
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c("left"),"")
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c("left"))
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c("right"))
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c("right"),legend.labs = c("<150$", "150$-300$",">300$"),legend.title="LTV")
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.8, 0.2),legend.labs = c("<150$", "150$-300$",">300$"),legend.title="LTV")
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(1, 1),legend.labs = c("<150$", "150$-300$",">300$"),legend.title="LTV")
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.9),legend.labs = c("<150$", "150$-300$",">300$"),legend.title="LTV")
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.5, 0.9),legend.labs = c("<150$", "150$-300$",">300$"),legend.title="LTV")
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.7),legend.labs = c("<150$", "150$-300$",">300$"),legend.title="LTV")
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("<150$", "150$-300$",">300$"),legend.title="LTV")
FNMA$VOL.CAT <- cut(FNMA$ORIG_AMT, breaks=c(-Inf,150000,300000, Inf), labels=c("<150k$", "150k$-300k$",">300k$"))
fit.LTV <- survfit(Surv(START,STOP,PREPAID)~strata(LTV.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("<150k$", "150k$-300k$",">300k$"),legend.title="LTV")
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(VOL.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("<150k$", "150k$-300k$",">300k$"),legend.title="LTV")
FNMA$VOL.CAT <- cut(FNMA$ORIG_AMT, breaks=c(-Inf,150000,300000, Inf), labels=c("1", "2","3"))
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(VOL.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("<150k$", "150k$-300k$",">300k$"),legend.title="LTV")
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("<150k$", "150k$-300k$",">300k$"),legend.title="LTV")
FNMA$VOL.CAT <- cut(FNMA$ORIG_AMT, breaks=c(-Inf,150000,300000, Inf), labels=c("<150", "150-300",">300"))
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(VOL.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("<150k$", "150k$-300k$",">300k$"),legend.title="LTV")
fit.LTV <- survfit(Surv(START,STOP,PREPAID)~strata(LTV.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("<65", "65-80",">80"),legend.title="LTV")
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("<150k$", "150k$-300k$",">300k$"),legend.title="Credit Volume")
fit.LTV <- survfit(Surv(START,STOP,PREPAID)~strata(LTV.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("<65", "65-80",">80"),legend.title="LTV")
ggsurvplot(fit.LTV, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("<65", "65-80",">80"),legend.title="LTV")
if (!(require(survminer))) install.packages ("survminer")
if (!(require(survival))) install.packages ("survival")
if (!(require(survminer))) install.packages ("survminer")
if (!(require(survival))) install.packages ("survival")
if (!(require(stargazer))) install.packages ("stargazer")
if (!(require(dplyr))) install.packages ("dplyr")
if (!(require(data.table))) install.packages ("data.table")
if (!(require(ggplot2))) install.packages ("ggplot2")
# load SMM/CPR Calculator function
source("SMM.R")
gc()
options(scipen=999)
options(digits=5)
load("C:/Users/Kons/OneDrive/MASTERARBEIT/DATA/PREPAYMENTSURV/FNMA.Rda")
### Further Data adjustments##
FNMA$OPTION.BI <- cut(FNMA$OPTION.LAG1, breaks=c(-Inf,0.5, Inf), labels=c("OTM","ITM"))
FNMA$LTV <- (FNMA$LAST_UPB/FNMA$HOUSEPRICE.DEV)*100
FNMA$LTV.CAT <- cut(FNMA$LTV, breaks=c(-Inf,65,80, Inf), labels=c("<65","65-80",">80"))
FNMA <- within(FNMA, LTV.CAT <- relevel(LTV.CAT, ref = 2))
FNMA$OCC_STAT[FNMA$OCC_STAT=="S"]<- "P"
FNMA$OCC_STAT <- factor(FNMA$OCC_STAT)
FNMA <- within(FNMA, OCC_STAT <- relevel(OCC_STAT, ref = 2))
FNMA$VOL.CAT <- cut(FNMA$ORIG_AMT, breaks=c(-Inf,150000,300000, Inf), labels=c("<150", "150-300",">300"))
FNMA <- within(FNMA, VOL.CAT <- relevel(VOL.CAT, ref = 1))
FNMA <- na.omit(FNMA)
###Kaplan-Meier estimates###
fit.null <- survfit(Surv(START,STOP,PREPAID)~1, data=FNMA)
ggsurvplot(fit.null, risk.table = TRUE,  palette=c("#86BC25"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(), legend=c("none"))
SMM.null<- SMM(fit.null)
ggplot(SMM.null, aes(x=time, y=CPR)) +
geom_line(aes(),colour="#86BC25")+
theme_bw()
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(VOL.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("<150k$", "150k$-300k$",">300k$"),legend.title="Credit Volume")
fit.LTV <- survfit(Surv(START,STOP,PREPAID)~strata(LTV.CAT), data=FNMA)
ggsurvplot(fit.LTV, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("<65", "65-80",">80"),legend.title="LTV")
FNMA$LTV.CAT <- cut(FNMA$LTV, breaks=c(-Inf,65,80, Inf), labels=c("<65","65-80",">80"))
FNMA <- within(FNMA, LTV.CAT <- relevel(LTV.CAT, ref = 1))
fit.LTV <- survfit(Surv(START,STOP,PREPAID)~strata(LTV.CAT), data=FNMA)
ggsurvplot(fit.LTV, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("<65", "65-80",">80"),legend.title="LTV")
if (!(require(survminer))) install.packages ("survminer")
if (!(require(survival))) install.packages ("survival")
if (!(require(stargazer))) install.packages ("stargazer")
if (!(require(dplyr))) install.packages ("dplyr")
if (!(require(data.table))) install.packages ("data.table")
if (!(require(ggplot2))) install.packages ("ggplot2")
# load SMM/CPR Calculator function
source("SMM.R")
gc()
options(scipen=999)
options(digits=5)
load("C:/Users/Kons/OneDrive/MASTERARBEIT/DATA/PREPAYMENTSURV/FNMA.Rda")
### Further Data adjustments##
FNMA$OPTION.BI <- cut(FNMA$OPTION.LAG1, breaks=c(-Inf,0.5, Inf), labels=c("OTM","ITM"))
FNMA$LTV <- (FNMA$LAST_UPB/FNMA$HOUSEPRICE.DEV)*100
FNMA$LTV.CAT <- cut(FNMA$LTV, breaks=c(-Inf,65,80, Inf), labels=c("<65","65-80",">80"))
FNMA <- within(FNMA, LTV.CAT <- relevel(LTV.CAT, ref = 2))
FNMA$OCC_STAT[FNMA$OCC_STAT=="S"]<- "P"
FNMA$OCC_STAT <- factor(FNMA$OCC_STAT)
FNMA <- within(FNMA, OCC_STAT <- relevel(OCC_STAT, ref = 2))
FNMA$VOL.CAT <- cut(FNMA$ORIG_AMT, breaks=c(-Inf,150000,300000, Inf), labels=c("<150", "150-300",">300"))
FNMA <- within(FNMA, VOL.CAT <- relevel(VOL.CAT, ref = 2))
FNMA <- na.omit(FNMA)
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(VOL.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("150k$-300k$","<150k$",">300k$"),legend.title="Credit Volume")
fit.LTV <- survfit(Surv(START,STOP,PREPAID)~strata(LTV.CAT), data=FNMA)
ggsurvplot(fit.LTV, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("65-80","<65",">80"),legend.title="LTV")
SMM.LTV<- SMM(fit.VOL)
SMM.null<- SMM(fit.null)
SMM.LTV<- SMM(fit.VOL)
test <- summary(fit.VOL)
test
test
summary(fit.LTV)
summary(fit.null)
fit1.table <- summary(fit.VOL)
fit1.table<- as.data.table(cbind(fit1.table$time,fit1.table$n.risk,fit1.table$n.event,fit1.table$n.censor,fit1.table$surv))
fit1.table <- summary(fit.null)
fit1.table<- as.data.table(cbind(fit1.table$time,fit1.table$n.risk,fit1.table$n.event,fit1.table$n.censor,fit1.table$surv))
fit1.table <- summary(fit.null)
fit2.table <- summary(fit.VOL)
fit1.table
fit1.table <- summary(fit.null)
summary(fit.VOL)
fit2.table
fit2.table<- as.data.table(cbind(fit1.table$time,fit1.table$n.risk,fit1.table$n.event,fit1.table$n.censor,fit1.table$surv))
View(fit2.table)
fit2.table<- as.data.table(cbind(fit2.table$time,fit1.table$n.risk,fit1.table$n.event,fit1.table$n.censor,fit1.table$surv))
View(fit2.table)
fit2.table <- summary(fit.VOL)
fit2.table<- as.data.table(cbind(fit2.table$time,fit1.table$n.risk,fit1.table$n.event,fit1.table$n.censor,fit1.table$surv))
fit2.table
str(fit2.table)
fit2.table <- summary(fit.VOL)
fit2.table
str(fit2.table)
fit1.table <- summary(fit.VOL)
fit1.table<- as.data.table(cbind(fit1.table$time,fit1.table$n.risk,fit1.table$n.event,fit1.table$n.censor,fit1.table$surv,fit1.table$strata))
fit1.table<- as.data.table(cbind(fit1.table$time,fit1.table$n.risk,fit1.table$n.event,fit1.table$surv,fit1.table$strata))
fit1.table <- summary(fit.VOL)
fit1.table<- as.data.table(cbind(fit1.table$time,fit1.table$n.risk,fit1.table$n.event,fit1.table$surv,fit1.table$strata))
colnames(fit1.table) <- c("time","N.risk","N.event","N.censor","SurvivalProb")
fit1.table
fit1.table <- summary(fit.VOL)
fit1.table<- as.data.table(cbind(fit1.table$time,fit1.table$n.risk,fit1.table$n.event,fit1.table$surv,fit1.table$strata))
colnames(fit1.table) <- c("time","N.risk","N.event","SurvivalProb","Strata")
fit1.table$SMM <- fit1.table$N.event/fit1.table$N.risk
fit1.table$CPR <- 1-(1-fit1.table$SMM)^12
fit1.table <- summary(fit.null)
fit1.table<- as.data.table(cbind(fit1.table$time,fit1.table$n.risk,fit1.table$n.event,fit1.table$surv,fit1.table$strata))
colnames(fit1.table) <- c("time","N.risk","N.event","SurvivalProb","Strata")
ncol(fit1.table)
fit1.table <- summary(fit.null)
fit1.table<- as.data.table(cbind(fit1.table$time,fit1.table$n.risk,fit1.table$n.event,fit1.table$surv,fit1.table$strata))
if(ncol(fit1.table) < 5) {
colnames(fit1.table) <- c("time","N.risk","N.event","SurvivalProb")
} else {
colnames(fit1.table) <- c("time","N.risk","N.event","SurvivalProb","Strata")}
fit1.table$SMM <- fit1.table$N.event/fit1.table$N.risk
fit1.table$CPR <- 1-(1-fit1.table$SMM)^12
fit1.table <- summary(fit.VOL)
fit1.table<- as.data.table(cbind(fit1.table$time,fit1.table$n.risk,fit1.table$n.event,fit1.table$surv,fit1.table$strata))
if(ncol(fit1.table) < 5) {
colnames(fit1.table) <- c("time","N.risk","N.event","SurvivalProb")
} else {
colnames(fit1.table) <- c("time","N.risk","N.event","SurvivalProb","Strata")}
fit1.table$SMM <- fit1.table$N.event/fit1.table$N.risk
fit1.table$CPR <- 1-(1-fit1.table$SMM)^12
if (!(require(survminer))) install.packages ("survminer")
if (!(require(survival))) install.packages ("survival")
if (!(require(stargazer))) install.packages ("stargazer")
if (!(require(dplyr))) install.packages ("dplyr")
if (!(require(data.table))) install.packages ("data.table")
if (!(require(ggplot2))) install.packages ("ggplot2")
# load SMM/CPR Calculator function
source("SMM.R")
gc()
options(scipen=999)
options(digits=5)
load("C:/Users/Kons/OneDrive/MASTERARBEIT/DATA/PREPAYMENTSURV/FNMA.Rda")
### Further Data adjustments##
FNMA$OPTION.BI <- cut(FNMA$OPTION.LAG1, breaks=c(-Inf,0.5, Inf), labels=c("OTM","ITM"))
FNMA$LTV <- (FNMA$LAST_UPB/FNMA$HOUSEPRICE.DEV)*100
FNMA$LTV.CAT <- cut(FNMA$LTV, breaks=c(-Inf,65,80, Inf), labels=c("<65","65-80",">80"))
FNMA <- within(FNMA, LTV.CAT <- relevel(LTV.CAT, ref = 2))
FNMA$OCC_STAT[FNMA$OCC_STAT=="S"]<- "P"
FNMA$OCC_STAT <- factor(FNMA$OCC_STAT)
FNMA <- within(FNMA, OCC_STAT <- relevel(OCC_STAT, ref = 2))
FNMA$VOL.CAT <- cut(FNMA$ORIG_AMT, breaks=c(-Inf,150000,300000, Inf), labels=c("<150", "150-300",">300"))
FNMA <- within(FNMA, VOL.CAT <- relevel(VOL.CAT, ref = 2))
FNMA <- na.omit(FNMA)
fit.null <- survfit(Surv(START,STOP,PREPAID)~1, data=FNMA)
ggsurvplot(fit.null, risk.table = TRUE,  palette=c("#86BC25"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(), legend=c("none"))
SMM.null<- SMM(fit.null)
ggplot(SMM.null, aes(x=time, y=CPR)) +
geom_line(aes(),colour="#86BC25")+
theme_bw()
SMM.null<- SMM(fit.null)
source("SMM.R")
SMM.null<- SMM(fit.null)
ggplot(SMM.null, aes(x=time, y=CPR)) +
geom_line(aes(),colour="#86BC25")+
theme_bw()
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(VOL.CAT), data=FNMA)
View(SMM.null)
SMM.VOL<- SMM(fit.VOL)
View(SMM.VOL)
ggplot(SMM.null, aes(x=time, y=CPR, color='Strata')) +
geom_line()
ggplot(SMM.VOL, aes(x=time, y=CPR, color='Strata')) +
geom_line()
ggplot(SMM.VOL, aes(x=time, y=CPR, color='strata')) +
geom_line()
SMM.VOL
ggplot(SMM.VOL, aes(x=time, y=CPR, color='factor(Strata)')) +
ggplot(SMM.VOL, aes(x=time, y=CPR, color='factor(Strata)')) +
geom_line()
View(SMM.VOL)
ggplot(SMM.VOL, aes(x=time, y=CPR, color=Strata)) +
ggplot(SMM.VOL, aes(x=time, y=CPR, color=Strata)) +
geom_line()
ggplot(SMM.VOL, aes(x=time, y=CPR, color=Strata)) +
geom_line()
View(SMM.VOL)
ggplot(SMM.VOL, aes(x=time, y=CPR, group=Strata)) +
geom_line(aes(color=Strata))+
theme_bw()
fit.LTV <- survfit(Surv(START,STOP,PREPAID)~strata(LTV.CAT), data=FNMA)
SMM.LTV<- SMM(fit.LTV)
ggplot(SMM.LTV, aes(x=time, y=CPR, group=Strata)) +
geom_line(aes(color=Strata))+
theme_bw()
View(SMM.LTV)
ggsurvplot(fit.LTV, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("65-80","<65",">80"),legend.title="LTV")
View(SMM)
source("SMM.R")
SMM.null<- SMM(fit.null)
SMM.VOL<- SMM(fit.VOL)
View(SMM.null)
View(SMM.VOL)
View(SMM)
source("SMM.R")
SMM.null<- SMM(fit.null)
SMM.null<- SMM(fit.null)
source("SMM.R")
fit.LTV$
source("SMM.R")
SMM.null<- SMM(fit.null)
SMM.null<- SMM(fit.null)
View(SMM)
source("SMM.R")
SMM.null<- SMM(fit.null)
View(SMM.null)
View(FNMA)
View(SMM)
SMM.null<- SMM(fit.null)
1-443/32029
443/32029
0.98617-0.01677
[1-0.01383]*[1-0.01678]
(1-0.01383)*(1-0.01678)
View(SMM)
SMM.null<- SMM(fit.null)
View(SMM.null)
source("SMM.R")
SMM.null<- SMM(fit.null)
View(SMM.null)
SMM.VOL<- SMM(fit.VOL)
View(SMM)
source("SMM.R")
SMM.null<- SMM(fit.null)
View(SMM)
source("SMM.R")
SMM.null<- SMM(fit.null)
View(SMM.null)
SMM.VOL<- SMM(fit.VOL)
View(SMM.VOL)
if (!(require(survminer))) install.packages ("survminer")
if (!(require(survival))) install.packages ("survival")
if (!(require(stargazer))) install.packages ("stargazer")
if (!(require(dplyr))) install.packages ("dplyr")
if (!(require(data.table))) install.packages ("data.table")
if (!(require(ggplot2))) install.packages ("ggplot2")
# load SMM/CPR Calculator function
source("SMM.R")
gc()
options(scipen=999)
options(digits=5)
load("C:/Users/Kons/OneDrive/MASTERARBEIT/DATA/PREPAYMENTSURV/FNMA.Rda")
### Further Data adjustments##
FNMA$OPTION.BI <- cut(FNMA$OPTION.LAG1, breaks=c(-Inf,0.5, Inf), labels=c("OTM","ITM"))
FNMA$LTV <- (FNMA$LAST_UPB/FNMA$HOUSEPRICE.DEV)*100
FNMA$LTV.CAT <- cut(FNMA$LTV, breaks=c(-Inf,65,80, Inf), labels=c("<65","65-80",">80"))
FNMA <- within(FNMA, LTV.CAT <- relevel(LTV.CAT, ref = 2))
FNMA$OCC_STAT[FNMA$OCC_STAT=="S"]<- "P"
FNMA$OCC_STAT <- factor(FNMA$OCC_STAT)
FNMA <- within(FNMA, OCC_STAT <- relevel(OCC_STAT, ref = 2))
FNMA$VOL.CAT <- cut(FNMA$ORIG_AMT, breaks=c(-Inf,150000,300000, Inf), labels=c("<150", "150-300",">300"))
FNMA <- within(FNMA, VOL.CAT <- relevel(VOL.CAT, ref = 2))
FNMA <- na.omit(FNMA)
###Kaplan-Meier estimates###
fit.null <- survfit(Surv(START,STOP,PREPAID)~1, data=FNMA)
ggsurvplot(fit.null, risk.table = TRUE,  palette=c("#86BC25"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(), legend=c("none"))
SMM.null<- SMM(fit.null)
ggplot(SMM.null, aes(x=time, y=CPR)) +
geom_line(aes(),colour="#86BC25")+
theme_bw()
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(VOL.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("150k$-300k$","<150k$",">300k$"),legend.title="Credit Volume")
SMM.VOL<- SMM(fit.VOL)
#@Jordan: Can u change the legend and the colors to the same as in the plot above=
ggplot(SMM.VOL, aes(x=time, y=CPR, group=Strata)) +
geom_line(aes(color=Strata))+
theme_bw()
fit.LTV <- survfit(Surv(START,STOP,PREPAID)~strata(LTV.CAT), data=FNMA)
SMM.LTV<- SMM(fit.LTV)
#@Jordan: Can u change the legend and the colors to the same as in the plot above=
ggplot(SMM.LTV, aes(x=time, y=CPR, group=Strata)) +
geom_line(aes(color=Strata))+
theme_bw()
ggsurvplot(fit.LTV, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("65-80","<65",">80"),legend.title="LTV")
9+9+9+3+6+3+6+9+9+9+9+9
9*2,7
fit.LTV <- survfit(Surv(START,STOP,PREPAID)~strata(OPTION.BI), data=FNMA)
fit.OPTION <- survfit(Surv(START,STOP,PREPAID)~strata(OPTION.BI), data=FNMA)
SMM.OPTION<- SMM(fit.OPTION)
ggplot(SMM.OPTION, aes(x=time, y=CPR, group=Strata)) +
geom_line(aes(color=Strata))+
theme_bw()
View(SMM.OPTION)
ggsurvplot(fit.OPTION, risk.table = TRUE,  palette=c("#86BC25","#0076A8"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("OTM","ITM"),legend.title="LTV")
FNMA$OPTION.BI <- cut(FNMA$OPTION.LAG1, breaks=c(-Inf,0, Inf), labels=c("OTM","ITM"))
fit.OPTION <- survfit(Surv(START,STOP,PREPAID)~strata(OPTION.BI), data=FNMA)
SMM.OPTION<- SMM(fit.OPTION)
ggsurvplot(fit.OPTION, risk.table = TRUE,  palette=c("#86BC25","#0076A8"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("OTM","ITM"),legend.title="LTV")
FNMA$OPTION.BI <- cut(FNMA$OPTION.LAG1, breaks=c(-Inf,0.75, Inf), labels=c("OTM","ITM"))
View(SMM.OPTION)
ggsurvplot(fit.OPTION, risk.table = TRUE,  palette=c("#86BC25","#0076A8"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("OTM","ITM"),legend.title="LTV")
fit.OPTION <- survfit(Surv(START,STOP,PREPAID)~strata(OPTION.BI), data=FNMA)
SMM.OPTION<- SMM(fit.OPTION)
ggsurvplot(fit.OPTION, risk.table = TRUE,  palette=c("#86BC25","#0076A8"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("OTM","ITM"),legend.title="LTV")
if (!(require(survminer))) install.packages ("survminer")
if (!(require(survival))) install.packages ("survival")
if (!(require(stargazer))) install.packages ("stargazer")
if (!(require(dplyr))) install.packages ("dplyr")
if (!(require(data.table))) install.packages ("data.table")
if (!(require(ggplot2))) install.packages ("ggplot2")
# load SMM/CPR Calculator function
source("SMM.R")
gc()
options(scipen=999)
options(digits=5)
load("C:/Users/Kons/OneDrive/MASTERARBEIT/DATA/PREPAYMENTSURV/FNMA.Rda")
### Further Data adjustments##
FNMA$OPTION.BI <- cut(FNMA$OPTION.LAG1, breaks=c(-Inf,0.75, Inf), labels=c("OTM","ITM"))
FNMA$LTV <- (FNMA$LAST_UPB/FNMA$HOUSEPRICE.DEV)*100
FNMA$LTV.CAT <- cut(FNMA$LTV, breaks=c(-Inf,65,80, Inf), labels=c("<65","65-80",">80"))
FNMA <- within(FNMA, LTV.CAT <- relevel(LTV.CAT, ref = 2))
FNMA$OCC_STAT[FNMA$OCC_STAT=="S"]<- "P"
FNMA$OCC_STAT <- factor(FNMA$OCC_STAT)
FNMA <- within(FNMA, OCC_STAT <- relevel(OCC_STAT, ref = 2))
FNMA$VOL.CAT <- cut(FNMA$ORIG_AMT, breaks=c(-Inf,150000,300000, Inf), labels=c("<150", "150-300",">300"))
FNMA <- within(FNMA, VOL.CAT <- relevel(VOL.CAT, ref = 2))
FNMA <- na.omit(FNMA)
###Kaplan-Meier estimates###
fit.null <- survfit(Surv(START,STOP,PREPAID)~1, data=FNMA)
ggsurvplot(fit.null, risk.table = TRUE,  palette=c("#86BC25"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(), legend=c("none"))
SMM.null<- SMM(fit.null)
ggplot(SMM.null, aes(x=time, y=CPR)) +
geom_line(aes(),colour="#86BC25")+
theme_bw()
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(VOL.CAT), data=FNMA)
setwd("C:/Users/Kons/OneDrive/MASTERARBEIT/DATA/PREPAYMENTSURV")
if (!(require(survminer))) install.packages ("survminer")
if (!(require(survival))) install.packages ("survival")
if (!(require(stargazer))) install.packages ("stargazer")
if (!(require(dplyr))) install.packages ("dplyr")
if (!(require(data.table))) install.packages ("data.table")
if (!(require(ggplot2))) install.packages ("ggplot2")
# load SMM/CPR Calculator function
source("SMM.R")
gc()
options(scipen=999)
options(digits=5)
load("C:/Users/Kons/OneDrive/MASTERARBEIT/DATA/PREPAYMENTSURV/FNMA.Rda")
### Further Data adjustments##
FNMA$OPTION.BI <- cut(FNMA$OPTION.LAG1, breaks=c(-Inf,0.75, Inf), labels=c("OTM","ITM"))
FNMA$LTV <- (FNMA$LAST_UPB/FNMA$HOUSEPRICE.DEV)*100
FNMA$LTV.CAT <- cut(FNMA$LTV, breaks=c(-Inf,65,80, Inf), labels=c("<65","65-80",">80"))
FNMA <- within(FNMA, LTV.CAT <- relevel(LTV.CAT, ref = 2))
FNMA$OCC_STAT[FNMA$OCC_STAT=="S"]<- "P"
FNMA$OCC_STAT <- factor(FNMA$OCC_STAT)
FNMA <- within(FNMA, OCC_STAT <- relevel(OCC_STAT, ref = 2))
FNMA$VOL.CAT <- cut(FNMA$ORIG_AMT, breaks=c(-Inf,150000,300000, Inf), labels=c("<150", "150-300",">300"))
FNMA <- within(FNMA, VOL.CAT <- relevel(VOL.CAT, ref = 2))
FNMA <- na.omit(FNMA)
###Kaplan-Meier estimates###
fit.null <- survfit(Surv(START,STOP,PREPAID)~1, data=FNMA)
ggsurvplot(fit.null, risk.table = TRUE,  palette=c("#86BC25"), censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(), legend=c("none"))
SMM.null<- SMM(fit.null)
ggplot(SMM.null, aes(x=time, y=CPR)) +
geom_line(aes(),colour="#86BC25")+
theme_bw()
fit.VOL <- survfit(Surv(START,STOP,PREPAID)~strata(VOL.CAT), data=FNMA)
ggsurvplot(fit.VOL, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("150k$-300k$","<150k$",">300k$"),legend.title="Credit Volume")
SMM.VOL<- SMM(fit.VOL)
#@Jordan: Can u change the legend and the colors to the same as in the plot above=
ggplot(SMM.VOL, aes(x=time, y=CPR, group=Strata)) +
geom_line(aes(color=Strata))+
theme_bw()
fit.LTV <- survfit(Surv(START,STOP,PREPAID)~strata(LTV.CAT), data=FNMA)
SMM.LTV<- SMM(fit.LTV)
#@Jordan: Can u change the legend and the colors to the same as in the plot above=
ggplot(SMM.LTV, aes(x=time, y=CPR, group=Strata)) +
geom_line(aes(color=Strata))+
theme_bw()
ggsurvplot(fit.LTV, risk.table = TRUE,  palette=c("#86BC25","#0076A8","#BBBCBC"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("65-80","<65",">80"),legend.title="LTV")
fit.OPTION <- survfit(Surv(START,STOP,PREPAID)~strata(OPTION.BI), data=FNMA)
SMM.OPTION<- SMM(fit.OPTION)
#@Jordan: Can u change the legend and the colors to the same as in the plot above=
ggplot(SMM.OPTION, aes(x=time, y=CPR, group=Strata)) +
geom_line(aes(color=Strata))+
theme_bw()
ggsurvplot(fit.OPTION, risk.table = TRUE,  palette=c("#86BC25","#0076A8"),
censor=FALSE, conf.int = TRUE, xlab="Month", ggtheme=theme_bw(),
legend=c(0.9, 0.8),legend.labs = c("OTM","ITM"),legend.title="LTV")
